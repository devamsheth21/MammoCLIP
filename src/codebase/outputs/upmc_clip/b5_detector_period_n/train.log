[2024-07-12 15:30:41,845][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/breast_cancer_kaggle/mammo_clip
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/breast_cancer_kaggle/mammo_clip
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/breast_cancer_kaggle/mammo_clip
    img_dir: RSNA_Breast_Imaging/Dataset/RSNA_Cancer_Detection/train_images_png
    data_path: RSNA_Breast_Imaging/Dataset/RSNA_Cancer_Detection/train_folds.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/breast_cancer_kaggle/mammo_clip/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /mnt/storage/breast_cancer_kaggle/mammo_clip/Mammo-CLIP/src/codebase/outputs/huggingface/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-12 15:30:41,845][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-12 15:30:41,852][breastclip.trainer][INFO] - local_rank: -1
[2024-07-12 15:30:41,853][breastclip.trainer][INFO] - distributed: False
[2024-07-12 15:30:41,957][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-12 15:30:41,957][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-12 15:30:41,957][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-12 15:30:41,957][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-12 15:30:41,975][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7fbf82f61b50>)
[2024-07-12 15:30:41,976][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-12 15:30:41,976][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-12 16:15:02,162][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/breast_cancer_kaggle/mammo_clip
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/breast_cancer_kaggle/mammo_clip
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/breast_cancer_kaggle/mammo_clip
    img_dir: RSNA_Breast_Imaging/Dataset/RSNA_Cancer_Detection/train_images_png
    data_path: RSNA_Breast_Imaging/Dataset/RSNA_Cancer_Detection/train_folds.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/configs/tokenizer
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /mnt/storage/breast_cancer_kaggle/mammo_clip/Mammo-CLIP/src/codebase/outputs/huggingface/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-12 16:15:02,163][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-12 16:15:02,170][breastclip.trainer][INFO] - local_rank: -1
[2024-07-12 16:15:02,170][breastclip.trainer][INFO] - distributed: False
[2024-07-12 16:15:02,287][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-12 16:15:02,287][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-12 16:15:02,287][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-12 16:15:02,287][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-12 16:15:02,307][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7f82fd80cd30>)
[2024-07-12 16:15:02,307][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-12 16:15:02,307][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-14 02:12:34,008][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/Devam/mammo-clip-github
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: RSNA_Breast_Imaging/Dataset/RSNA_Cancer_Detection/train_images_png
    data_path: RSNA_Breast_Imaging/Dataset/RSNA_Cancer_Detection/train_folds.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-14 02:12:34,009][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-14 02:12:34,015][breastclip.trainer][INFO] - local_rank: -1
[2024-07-14 02:12:34,015][breastclip.trainer][INFO] - distributed: False
[2024-07-14 02:12:34,118][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-14 02:12:34,118][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-14 02:12:34,118][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-14 02:12:34,118][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-14 02:12:34,138][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7fdf86f8cc70>)
[2024-07-14 02:12:34,138][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-14 02:12:34,138][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-14 02:12:34,439][breastclip.data.datasets.imagetext][INFO] - split: train transform
[2024-07-14 02:12:34,439][breastclip.data.datasets.imagetext][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-14 02:12:34,447][breastclip.data.datasets.imagetext][INFO] - split: valid transform
[2024-07-14 02:12:34,447][breastclip.data.datasets.imagetext][INFO] - None
[2024-07-14 02:12:34,447][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-14 02:12:34,447][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-14 02:12:34,447][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-14 02:12:34,447][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-14 02:12:34,447][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-14 02:12:34,447][breastclip.data.datamodule][INFO] - Dataset: rsna_wo_period is loaded
[2024-07-14 02:17:05,170][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/Devam/mammo-clip-github
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: RSNA_Breast_Imaging/Dataset/RSNA_Cancer_Detection/train_images_png
    data_path: RSNA_Breast_Imaging/Dataset/RSNA_Cancer_Detection/train_folds.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-14 02:17:05,171][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-14 02:17:05,178][breastclip.trainer][INFO] - local_rank: -1
[2024-07-14 02:17:05,178][breastclip.trainer][INFO] - distributed: False
[2024-07-14 02:17:05,282][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-14 02:17:05,282][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-14 02:17:05,282][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-14 02:17:05,282][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-14 02:17:05,302][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7f5584089370>)
[2024-07-14 02:17:05,302][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-14 02:17:05,302][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-14 02:17:05,558][breastclip.data.datasets.imagetext][INFO] - split: train transform
[2024-07-14 02:17:05,558][breastclip.data.datasets.imagetext][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-14 02:17:05,565][breastclip.data.datasets.imagetext][INFO] - split: valid transform
[2024-07-14 02:17:05,565][breastclip.data.datasets.imagetext][INFO] - None
[2024-07-14 02:17:05,565][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-14 02:17:05,565][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-14 02:17:05,565][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-14 02:17:05,565][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-14 02:17:05,565][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-14 02:17:05,565][breastclip.data.datamodule][INFO] - Dataset: rsna_wo_period is loaded
[2024-07-14 02:17:36,072][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/Devam/mammo-clip-github
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv_final_1.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-14 02:17:36,072][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-14 02:17:36,080][breastclip.trainer][INFO] - local_rank: -1
[2024-07-14 02:17:36,080][breastclip.trainer][INFO] - distributed: False
[2024-07-14 02:17:36,181][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-14 02:17:36,181][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-14 02:17:36,181][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-14 02:17:36,181][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-14 02:17:36,201][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7fe307d72bb0>)
[2024-07-14 02:17:36,201][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-14 02:17:36,201][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-14 02:17:36,383][breastclip.data.datasets.imagetext][INFO] - split: train transform
[2024-07-14 02:17:36,383][breastclip.data.datasets.imagetext][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-14 02:17:36,390][breastclip.data.datasets.imagetext][INFO] - split: valid transform
[2024-07-14 02:17:36,390][breastclip.data.datasets.imagetext][INFO] - None
[2024-07-14 02:17:36,391][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-14 02:17:36,391][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-14 02:17:36,391][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-14 02:17:36,391][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-14 02:17:36,391][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-14 02:17:36,391][breastclip.data.datamodule][INFO] - Dataset: rsna_wo_period is loaded
[2024-07-14 02:18:01,493][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/Devam/mammo-clip-github
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-14 02:18:01,493][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-14 02:18:01,500][breastclip.trainer][INFO] - local_rank: -1
[2024-07-14 02:18:01,500][breastclip.trainer][INFO] - distributed: False
[2024-07-14 02:18:01,598][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-14 02:18:01,599][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-14 02:18:01,599][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-14 02:18:01,599][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-14 02:18:01,618][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7f07d0a67c70>)
[2024-07-14 02:18:01,618][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-14 02:18:01,618][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-14 02:18:01,783][breastclip.data.datasets.imagetext][INFO] - split: train transform
[2024-07-14 02:18:01,783][breastclip.data.datasets.imagetext][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-14 02:18:01,790][breastclip.data.datasets.imagetext][INFO] - split: valid transform
[2024-07-14 02:18:01,791][breastclip.data.datasets.imagetext][INFO] - None
[2024-07-14 02:18:01,791][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-14 02:18:01,791][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-14 02:18:01,791][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-14 02:18:01,791][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-14 02:18:01,791][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-14 02:18:01,791][breastclip.data.datamodule][INFO] - Dataset: rsna_wo_period is loaded
[2024-07-14 02:18:01,952][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [train]
[2024-07-14 02:18:01,953][breastclip.data.datasets.image_classification][INFO] - split: train transform
[2024-07-14 02:18:01,953][breastclip.data.datasets.image_classification][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-14 02:18:01,953][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [valid]
[2024-07-14 02:18:01,953][breastclip.data.datasets.image_classification][INFO] - split: valid transform
[2024-07-14 02:18:01,953][breastclip.data.datasets.image_classification][INFO] - None
[2024-07-14 02:18:01,953][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-14 02:18:01,953][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-14 02:18:01,953][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-14 02:18:01,953][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-14 02:18:01,953][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-14 02:18:01,953][breastclip.data.datamodule][INFO] - Dataset: rsna_zs is loaded
[2024-07-14 02:18:01,954][breastclip.trainer][INFO] - cuda: Build the model
[2024-07-14 23:15:00,344][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/Devam/mammo-clip-github
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-14 23:15:00,344][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-14 23:15:00,352][breastclip.trainer][INFO] - local_rank: -1
[2024-07-14 23:15:00,352][breastclip.trainer][INFO] - distributed: False
[2024-07-14 23:15:00,462][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-14 23:15:00,462][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-14 23:15:00,462][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-14 23:15:00,462][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-14 23:15:00,482][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7fbebdedfcd0>)
[2024-07-14 23:15:00,482][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-14 23:15:00,482][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-14 23:15:00,749][breastclip.data.datasets.imagetext][INFO] - split: train transform
[2024-07-14 23:15:00,749][breastclip.data.datasets.imagetext][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-14 23:15:00,756][breastclip.data.datasets.imagetext][INFO] - split: valid transform
[2024-07-14 23:15:00,756][breastclip.data.datasets.imagetext][INFO] - None
[2024-07-14 23:15:00,756][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-14 23:15:00,756][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-14 23:15:00,756][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-14 23:15:00,756][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-14 23:15:00,756][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-14 23:15:00,756][breastclip.data.datamodule][INFO] - Dataset: rsna_wo_period is loaded
[2024-07-14 23:15:00,912][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [train]
[2024-07-14 23:15:00,913][breastclip.data.datasets.image_classification][INFO] - split: train transform
[2024-07-14 23:15:00,913][breastclip.data.datasets.image_classification][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-14 23:15:00,913][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [valid]
[2024-07-14 23:15:00,913][breastclip.data.datasets.image_classification][INFO] - split: valid transform
[2024-07-14 23:15:00,913][breastclip.data.datasets.image_classification][INFO] - None
[2024-07-14 23:15:00,913][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-14 23:15:00,913][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-14 23:15:00,913][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-14 23:15:00,913][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-14 23:15:00,913][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-14 23:15:00,913][breastclip.data.datamodule][INFO] - Dataset: rsna_zs is loaded
[2024-07-14 23:15:00,913][breastclip.trainer][INFO] - cuda: Build the model
[2024-07-15 10:37:48,648][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/Devam/mammo-clip-github
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /home/devam/.cache/huggingface/hub/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-15 10:37:48,648][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-15 10:37:48,655][breastclip.trainer][INFO] - local_rank: -1
[2024-07-15 10:37:48,655][breastclip.trainer][INFO] - distributed: False
[2024-07-15 10:37:48,765][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-15 10:37:48,765][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-15 10:37:48,765][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-15 10:37:48,765][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-15 10:37:48,784][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7f115f761af0>)
[2024-07-15 10:37:48,784][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-15 10:37:48,784][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-15 10:37:49,050][breastclip.data.datasets.imagetext][INFO] - split: train transform
[2024-07-15 10:37:49,050][breastclip.data.datasets.imagetext][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 10:37:49,057][breastclip.data.datasets.imagetext][INFO] - split: valid transform
[2024-07-15 10:37:49,057][breastclip.data.datasets.imagetext][INFO] - None
[2024-07-15 10:37:49,057][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 10:37:49,058][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 10:37:49,058][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 10:37:49,058][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 10:37:49,058][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 10:37:49,058][breastclip.data.datamodule][INFO] - Dataset: rsna_wo_period is loaded
[2024-07-15 10:37:49,219][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [train]
[2024-07-15 10:37:49,219][breastclip.data.datasets.image_classification][INFO] - split: train transform
[2024-07-15 10:37:49,220][breastclip.data.datasets.image_classification][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 10:37:49,220][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [valid]
[2024-07-15 10:37:49,220][breastclip.data.datasets.image_classification][INFO] - split: valid transform
[2024-07-15 10:37:49,220][breastclip.data.datasets.image_classification][INFO] - None
[2024-07-15 10:37:49,220][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 10:37:49,220][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 10:37:49,220][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 10:37:49,220][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 10:37:49,220][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 10:37:49,220][breastclip.data.datamodule][INFO] - Dataset: rsna_zs is loaded
[2024-07-15 10:37:49,220][breastclip.trainer][INFO] - cuda: Build the model
[2024-07-15 10:37:51,406][breastclip.trainer][INFO] - cuda: Model info:
BreastClip(
  (image_encoder): EfficientNet(
    (_conv_stem): Conv2dStaticSamePadding(
      3, 48, kernel_size=(3, 3), stride=(2, 2), bias=False
      (static_padding): ZeroPad2d((0, 1, 0, 1))
    )
    (_bn0): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_blocks): ModuleList(
      (0): MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          48, 48, kernel_size=(3, 3), stride=[1, 1], groups=48, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          48, 12, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          12, 48, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          48, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (1-2): 2 x MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(3, 3), stride=(1, 1), groups=24, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          24, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 24, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (3): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          24, 144, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          144, 144, kernel_size=(3, 3), stride=[2, 2], groups=144, bias=False
          (static_padding): ZeroPad2d((0, 1, 0, 1))
        )
        (_bn1): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          144, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 144, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          144, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (4-7): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(3, 3), stride=(1, 1), groups=240, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (8): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(5, 5), stride=[2, 2], groups=240, bias=False
          (static_padding): ZeroPad2d((1, 2, 1, 2))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (9-12): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(5, 5), stride=(1, 1), groups=384, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (13): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(3, 3), stride=[2, 2], groups=384, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (14-19): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(3, 3), stride=(1, 1), groups=768, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (20): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(5, 5), stride=[1, 1], groups=768, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (21-26): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=(1, 1), groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (27): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=[2, 2], groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (28-35): 8 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(5, 5), stride=(1, 1), groups=1824, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (36): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(3, 3), stride=[1, 1], groups=1824, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (37-38): 2 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          512, 3072, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          3072, 3072, kernel_size=(3, 3), stride=(1, 1), groups=3072, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          3072, 128, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          128, 3072, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          3072, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
    )
    (_conv_head): Conv2dStaticSamePadding(
      512, 2048, kernel_size=(1, 1), stride=(1, 1), bias=False
      (static_padding): Identity()
    )
    (_bn1): BatchNorm2d(2048, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_avg_pooling): AdaptiveAvgPool2d(output_size=1)
    (_dropout): Dropout(p=0.4, inplace=False)
    (_swish): MemoryEfficientSwish()
  )
  (text_encoder): HuggingfaceTextEncoder(
    (text_encoder): BertModel(
      (embeddings): BertEmbeddings(
        (word_embeddings): Embedding(28996, 768, padding_idx=0)
        (position_embeddings): Embedding(512, 768)
        (token_type_embeddings): Embedding(2, 768)
        (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
        (dropout): Dropout(p=0.1, inplace=False)
      )
      (encoder): BertEncoder(
        (layer): ModuleList(
          (0-11): 12 x BertLayer(
            (attention): BertAttention(
              (self): BertSdpaSelfAttention(
                (query): Linear(in_features=768, out_features=768, bias=True)
                (key): Linear(in_features=768, out_features=768, bias=True)
                (value): Linear(in_features=768, out_features=768, bias=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
              (output): BertSelfOutput(
                (dense): Linear(in_features=768, out_features=768, bias=True)
                (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
            )
            (intermediate): BertIntermediate(
              (dense): Linear(in_features=768, out_features=3072, bias=True)
              (intermediate_act_fn): GELUActivation()
            )
            (output): BertOutput(
              (dense): Linear(in_features=3072, out_features=768, bias=True)
              (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
              (dropout): Dropout(p=0.1, inplace=False)
            )
          )
        )
      )
      (pooler): BertPooler(
        (dense): Linear(in_features=768, out_features=768, bias=True)
        (activation): Tanh()
      )
    )
  )
  (image_projection): LinearProjectionHead(
    (projection): Linear(in_features=2048, out_features=512, bias=True)
  )
  (text_projection): LinearProjectionHead(
    (projection): Linear(in_features=768, out_features=512, bias=True)
  )
)
[2024-07-15 10:37:51,407][breastclip.trainer][INFO] - cuda: Build the loss function
[2024-07-15 10:37:51,407][breastclip.trainer][INFO] - cuda: Build the optimizer
[2024-07-15 10:37:51,408][breastclip.trainer][INFO] - cuda: Build the LR scheulder
[2024-07-15 10:37:51,409][breastclip.trainer][INFO] - Download nltk module
[2024-07-15 10:37:52,005][breastclip.trainer][INFO] - zs_prompts: {'upmc': ['birads category 0', 'birads category 1', 'birads category 2'], 'rsna': ['no malignancy', 'malignancy']}
[2024-07-15 10:37:52,006][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7f115f763280>}
[2024-07-15 10:37:52,006][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7f115f752340>}
[2024-07-15 10:37:52,024][breastclip.trainer][INFO] - cuda: Training the model
[2024-07-15 10:41:12,336][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/Devam/mammo-clip-github
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /home/devam/.cache/huggingface/hub/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-15 10:41:12,336][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-15 10:41:12,344][breastclip.trainer][INFO] - local_rank: -1
[2024-07-15 10:41:12,344][breastclip.trainer][INFO] - distributed: False
[2024-07-15 10:41:12,450][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-15 10:41:12,450][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-15 10:41:12,450][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-15 10:41:12,450][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-15 10:41:12,470][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7f533de91130>)
[2024-07-15 10:41:12,470][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-15 10:41:12,470][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-15 10:41:12,739][breastclip.data.datasets.imagetext][INFO] - split: train transform
[2024-07-15 10:41:12,739][breastclip.data.datasets.imagetext][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 10:41:12,747][breastclip.data.datasets.imagetext][INFO] - split: valid transform
[2024-07-15 10:41:12,747][breastclip.data.datasets.imagetext][INFO] - None
[2024-07-15 10:41:12,747][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 10:41:12,747][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 10:41:12,747][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 10:41:12,747][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 10:41:12,747][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 10:41:12,747][breastclip.data.datamodule][INFO] - Dataset: rsna_wo_period is loaded
[2024-07-15 10:41:12,902][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [train]
[2024-07-15 10:41:12,902][breastclip.data.datasets.image_classification][INFO] - split: train transform
[2024-07-15 10:41:12,902][breastclip.data.datasets.image_classification][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 10:41:12,902][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [valid]
[2024-07-15 10:41:12,902][breastclip.data.datasets.image_classification][INFO] - split: valid transform
[2024-07-15 10:41:12,902][breastclip.data.datasets.image_classification][INFO] - None
[2024-07-15 10:41:12,903][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 10:41:12,903][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 10:41:12,903][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 10:41:12,903][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 10:41:12,903][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 10:41:12,903][breastclip.data.datamodule][INFO] - Dataset: rsna_zs is loaded
[2024-07-15 10:41:12,903][breastclip.trainer][INFO] - cuda: Build the model
[2024-07-15 10:41:15,118][breastclip.trainer][INFO] - cuda: Model info:
BreastClip(
  (image_encoder): EfficientNet(
    (_conv_stem): Conv2dStaticSamePadding(
      3, 48, kernel_size=(3, 3), stride=(2, 2), bias=False
      (static_padding): ZeroPad2d((0, 1, 0, 1))
    )
    (_bn0): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_blocks): ModuleList(
      (0): MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          48, 48, kernel_size=(3, 3), stride=[1, 1], groups=48, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          48, 12, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          12, 48, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          48, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (1-2): 2 x MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(3, 3), stride=(1, 1), groups=24, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          24, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 24, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (3): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          24, 144, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          144, 144, kernel_size=(3, 3), stride=[2, 2], groups=144, bias=False
          (static_padding): ZeroPad2d((0, 1, 0, 1))
        )
        (_bn1): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          144, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 144, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          144, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (4-7): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(3, 3), stride=(1, 1), groups=240, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (8): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(5, 5), stride=[2, 2], groups=240, bias=False
          (static_padding): ZeroPad2d((1, 2, 1, 2))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (9-12): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(5, 5), stride=(1, 1), groups=384, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (13): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(3, 3), stride=[2, 2], groups=384, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (14-19): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(3, 3), stride=(1, 1), groups=768, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (20): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(5, 5), stride=[1, 1], groups=768, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (21-26): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=(1, 1), groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (27): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=[2, 2], groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (28-35): 8 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(5, 5), stride=(1, 1), groups=1824, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (36): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(3, 3), stride=[1, 1], groups=1824, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (37-38): 2 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          512, 3072, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          3072, 3072, kernel_size=(3, 3), stride=(1, 1), groups=3072, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          3072, 128, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          128, 3072, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          3072, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
    )
    (_conv_head): Conv2dStaticSamePadding(
      512, 2048, kernel_size=(1, 1), stride=(1, 1), bias=False
      (static_padding): Identity()
    )
    (_bn1): BatchNorm2d(2048, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_avg_pooling): AdaptiveAvgPool2d(output_size=1)
    (_dropout): Dropout(p=0.4, inplace=False)
    (_swish): MemoryEfficientSwish()
  )
  (text_encoder): HuggingfaceTextEncoder(
    (text_encoder): BertModel(
      (embeddings): BertEmbeddings(
        (word_embeddings): Embedding(28996, 768, padding_idx=0)
        (position_embeddings): Embedding(512, 768)
        (token_type_embeddings): Embedding(2, 768)
        (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
        (dropout): Dropout(p=0.1, inplace=False)
      )
      (encoder): BertEncoder(
        (layer): ModuleList(
          (0-11): 12 x BertLayer(
            (attention): BertAttention(
              (self): BertSdpaSelfAttention(
                (query): Linear(in_features=768, out_features=768, bias=True)
                (key): Linear(in_features=768, out_features=768, bias=True)
                (value): Linear(in_features=768, out_features=768, bias=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
              (output): BertSelfOutput(
                (dense): Linear(in_features=768, out_features=768, bias=True)
                (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
            )
            (intermediate): BertIntermediate(
              (dense): Linear(in_features=768, out_features=3072, bias=True)
              (intermediate_act_fn): GELUActivation()
            )
            (output): BertOutput(
              (dense): Linear(in_features=3072, out_features=768, bias=True)
              (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
              (dropout): Dropout(p=0.1, inplace=False)
            )
          )
        )
      )
      (pooler): BertPooler(
        (dense): Linear(in_features=768, out_features=768, bias=True)
        (activation): Tanh()
      )
    )
  )
  (image_projection): LinearProjectionHead(
    (projection): Linear(in_features=2048, out_features=512, bias=True)
  )
  (text_projection): LinearProjectionHead(
    (projection): Linear(in_features=768, out_features=512, bias=True)
  )
)
[2024-07-15 10:41:15,119][breastclip.trainer][INFO] - cuda: Build the loss function
[2024-07-15 10:41:15,119][breastclip.trainer][INFO] - cuda: Build the optimizer
[2024-07-15 10:41:15,121][breastclip.trainer][INFO] - cuda: Build the LR scheulder
[2024-07-15 10:41:15,121][breastclip.trainer][INFO] - Download nltk module
[2024-07-15 10:41:15,305][breastclip.trainer][INFO] - zs_prompts: {'upmc': ['birads category 0', 'birads category 1', 'birads category 2'], 'rsna': ['no malignancy', 'malignancy']}
[2024-07-15 10:41:15,306][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7f532284fac0>}
[2024-07-15 10:41:15,306][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7f532283e4f0>}
[2024-07-15 10:41:15,316][breastclip.trainer][INFO] - cuda: Training the model
[2024-07-15 10:45:24,133][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/Devam/mammo-clip-github
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /home/devam/.cache/huggingface/hub/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-15 10:45:24,133][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-15 10:45:24,140][breastclip.trainer][INFO] - local_rank: -1
[2024-07-15 10:45:24,140][breastclip.trainer][INFO] - distributed: False
[2024-07-15 10:45:24,255][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-15 10:45:24,255][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-15 10:45:24,255][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-15 10:45:24,255][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-15 10:45:24,275][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7fc930697f70>)
[2024-07-15 10:45:24,275][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-15 10:45:24,275][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-15 10:45:24,548][breastclip.data.datasets.imagetext][INFO] - split: train transform
[2024-07-15 10:45:24,548][breastclip.data.datasets.imagetext][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 10:45:24,555][breastclip.data.datasets.imagetext][INFO] - split: valid transform
[2024-07-15 10:45:24,555][breastclip.data.datasets.imagetext][INFO] - None
[2024-07-15 10:45:24,555][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 10:45:24,555][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 10:45:24,555][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 10:45:24,555][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 10:45:24,555][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 10:45:24,555][breastclip.data.datamodule][INFO] - Dataset: rsna_wo_period is loaded
[2024-07-15 10:45:24,704][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [train]
[2024-07-15 10:45:24,704][breastclip.data.datasets.image_classification][INFO] - split: train transform
[2024-07-15 10:45:24,704][breastclip.data.datasets.image_classification][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 10:45:24,705][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [valid]
[2024-07-15 10:45:24,705][breastclip.data.datasets.image_classification][INFO] - split: valid transform
[2024-07-15 10:45:24,705][breastclip.data.datasets.image_classification][INFO] - None
[2024-07-15 10:45:24,705][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 10:45:24,705][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 10:45:24,705][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 10:45:24,705][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 10:45:24,705][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 10:45:24,705][breastclip.data.datamodule][INFO] - Dataset: rsna_zs is loaded
[2024-07-15 10:45:24,705][breastclip.trainer][INFO] - cuda: Build the model
[2024-07-15 10:45:26,912][breastclip.trainer][INFO] - cuda: Model info:
BreastClip(
  (image_encoder): EfficientNet(
    (_conv_stem): Conv2dStaticSamePadding(
      3, 48, kernel_size=(3, 3), stride=(2, 2), bias=False
      (static_padding): ZeroPad2d((0, 1, 0, 1))
    )
    (_bn0): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_blocks): ModuleList(
      (0): MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          48, 48, kernel_size=(3, 3), stride=[1, 1], groups=48, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          48, 12, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          12, 48, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          48, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (1-2): 2 x MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(3, 3), stride=(1, 1), groups=24, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          24, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 24, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (3): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          24, 144, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          144, 144, kernel_size=(3, 3), stride=[2, 2], groups=144, bias=False
          (static_padding): ZeroPad2d((0, 1, 0, 1))
        )
        (_bn1): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          144, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 144, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          144, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (4-7): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(3, 3), stride=(1, 1), groups=240, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (8): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(5, 5), stride=[2, 2], groups=240, bias=False
          (static_padding): ZeroPad2d((1, 2, 1, 2))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (9-12): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(5, 5), stride=(1, 1), groups=384, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (13): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(3, 3), stride=[2, 2], groups=384, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (14-19): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(3, 3), stride=(1, 1), groups=768, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (20): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(5, 5), stride=[1, 1], groups=768, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (21-26): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=(1, 1), groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (27): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=[2, 2], groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (28-35): 8 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(5, 5), stride=(1, 1), groups=1824, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (36): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(3, 3), stride=[1, 1], groups=1824, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (37-38): 2 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          512, 3072, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          3072, 3072, kernel_size=(3, 3), stride=(1, 1), groups=3072, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          3072, 128, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          128, 3072, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          3072, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
    )
    (_conv_head): Conv2dStaticSamePadding(
      512, 2048, kernel_size=(1, 1), stride=(1, 1), bias=False
      (static_padding): Identity()
    )
    (_bn1): BatchNorm2d(2048, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_avg_pooling): AdaptiveAvgPool2d(output_size=1)
    (_dropout): Dropout(p=0.4, inplace=False)
    (_swish): MemoryEfficientSwish()
  )
  (text_encoder): HuggingfaceTextEncoder(
    (text_encoder): BertModel(
      (embeddings): BertEmbeddings(
        (word_embeddings): Embedding(28996, 768, padding_idx=0)
        (position_embeddings): Embedding(512, 768)
        (token_type_embeddings): Embedding(2, 768)
        (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
        (dropout): Dropout(p=0.1, inplace=False)
      )
      (encoder): BertEncoder(
        (layer): ModuleList(
          (0-11): 12 x BertLayer(
            (attention): BertAttention(
              (self): BertSdpaSelfAttention(
                (query): Linear(in_features=768, out_features=768, bias=True)
                (key): Linear(in_features=768, out_features=768, bias=True)
                (value): Linear(in_features=768, out_features=768, bias=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
              (output): BertSelfOutput(
                (dense): Linear(in_features=768, out_features=768, bias=True)
                (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
            )
            (intermediate): BertIntermediate(
              (dense): Linear(in_features=768, out_features=3072, bias=True)
              (intermediate_act_fn): GELUActivation()
            )
            (output): BertOutput(
              (dense): Linear(in_features=3072, out_features=768, bias=True)
              (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
              (dropout): Dropout(p=0.1, inplace=False)
            )
          )
        )
      )
      (pooler): BertPooler(
        (dense): Linear(in_features=768, out_features=768, bias=True)
        (activation): Tanh()
      )
    )
  )
  (image_projection): LinearProjectionHead(
    (projection): Linear(in_features=2048, out_features=512, bias=True)
  )
  (text_projection): LinearProjectionHead(
    (projection): Linear(in_features=768, out_features=512, bias=True)
  )
)
[2024-07-15 10:45:26,912][breastclip.trainer][INFO] - cuda: Build the loss function
[2024-07-15 10:45:26,912][breastclip.trainer][INFO] - cuda: Build the optimizer
[2024-07-15 10:45:26,914][breastclip.trainer][INFO] - cuda: Build the LR scheulder
[2024-07-15 10:45:26,914][breastclip.trainer][INFO] - Download nltk module
[2024-07-15 10:45:27,084][breastclip.trainer][INFO] - zs_prompts: {'upmc': ['birads category 0', 'birads category 1', 'birads category 2'], 'rsna': ['no malignancy', 'malignancy']}
[2024-07-15 10:45:27,085][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7fc93069c670>}
[2024-07-15 10:45:27,085][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7fc93068c820>}
[2024-07-15 10:45:27,096][breastclip.trainer][INFO] - cuda: Training the model
[2024-07-15 10:48:19,191][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/Devam/mammo-clip-github
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /home/devam/.cache/huggingface/hub/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-15 10:48:19,191][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-15 10:48:19,200][breastclip.trainer][INFO] - local_rank: -1
[2024-07-15 10:48:19,201][breastclip.trainer][INFO] - distributed: False
[2024-07-15 10:48:19,313][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-15 10:48:19,314][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-15 10:48:19,314][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-15 10:48:19,314][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-15 10:48:19,334][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7fe1e20e8c40>)
[2024-07-15 10:48:19,334][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-15 10:48:19,334][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-15 10:48:19,591][breastclip.data.datasets.imagetext][INFO] - split: train transform
[2024-07-15 10:48:19,591][breastclip.data.datasets.imagetext][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 10:48:19,598][breastclip.data.datasets.imagetext][INFO] - split: valid transform
[2024-07-15 10:48:19,598][breastclip.data.datasets.imagetext][INFO] - None
[2024-07-15 10:48:19,598][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 10:48:19,598][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 10:48:19,598][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 10:48:19,598][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 10:48:19,598][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 10:48:19,598][breastclip.data.datamodule][INFO] - Dataset: rsna_wo_period is loaded
[2024-07-15 10:48:19,744][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [train]
[2024-07-15 10:48:19,744][breastclip.data.datasets.image_classification][INFO] - split: train transform
[2024-07-15 10:48:19,744][breastclip.data.datasets.image_classification][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 10:48:19,745][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [valid]
[2024-07-15 10:48:19,745][breastclip.data.datasets.image_classification][INFO] - split: valid transform
[2024-07-15 10:48:19,745][breastclip.data.datasets.image_classification][INFO] - None
[2024-07-15 10:48:19,745][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 10:48:19,745][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 10:48:19,745][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 10:48:19,745][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 10:48:19,745][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 10:48:19,745][breastclip.data.datamodule][INFO] - Dataset: rsna_zs is loaded
[2024-07-15 10:48:19,745][breastclip.trainer][INFO] - cuda: Build the model
[2024-07-15 10:48:21,948][breastclip.trainer][INFO] - cuda: Model info:
BreastClip(
  (image_encoder): EfficientNet(
    (_conv_stem): Conv2dStaticSamePadding(
      3, 48, kernel_size=(3, 3), stride=(2, 2), bias=False
      (static_padding): ZeroPad2d((0, 1, 0, 1))
    )
    (_bn0): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_blocks): ModuleList(
      (0): MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          48, 48, kernel_size=(3, 3), stride=[1, 1], groups=48, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          48, 12, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          12, 48, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          48, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (1-2): 2 x MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(3, 3), stride=(1, 1), groups=24, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          24, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 24, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (3): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          24, 144, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          144, 144, kernel_size=(3, 3), stride=[2, 2], groups=144, bias=False
          (static_padding): ZeroPad2d((0, 1, 0, 1))
        )
        (_bn1): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          144, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 144, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          144, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (4-7): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(3, 3), stride=(1, 1), groups=240, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (8): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(5, 5), stride=[2, 2], groups=240, bias=False
          (static_padding): ZeroPad2d((1, 2, 1, 2))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (9-12): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(5, 5), stride=(1, 1), groups=384, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (13): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(3, 3), stride=[2, 2], groups=384, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (14-19): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(3, 3), stride=(1, 1), groups=768, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (20): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(5, 5), stride=[1, 1], groups=768, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (21-26): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=(1, 1), groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (27): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=[2, 2], groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (28-35): 8 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(5, 5), stride=(1, 1), groups=1824, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (36): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(3, 3), stride=[1, 1], groups=1824, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (37-38): 2 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          512, 3072, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          3072, 3072, kernel_size=(3, 3), stride=(1, 1), groups=3072, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          3072, 128, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          128, 3072, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          3072, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
    )
    (_conv_head): Conv2dStaticSamePadding(
      512, 2048, kernel_size=(1, 1), stride=(1, 1), bias=False
      (static_padding): Identity()
    )
    (_bn1): BatchNorm2d(2048, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_avg_pooling): AdaptiveAvgPool2d(output_size=1)
    (_dropout): Dropout(p=0.4, inplace=False)
    (_swish): MemoryEfficientSwish()
  )
  (text_encoder): HuggingfaceTextEncoder(
    (text_encoder): BertModel(
      (embeddings): BertEmbeddings(
        (word_embeddings): Embedding(28996, 768, padding_idx=0)
        (position_embeddings): Embedding(512, 768)
        (token_type_embeddings): Embedding(2, 768)
        (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
        (dropout): Dropout(p=0.1, inplace=False)
      )
      (encoder): BertEncoder(
        (layer): ModuleList(
          (0-11): 12 x BertLayer(
            (attention): BertAttention(
              (self): BertSdpaSelfAttention(
                (query): Linear(in_features=768, out_features=768, bias=True)
                (key): Linear(in_features=768, out_features=768, bias=True)
                (value): Linear(in_features=768, out_features=768, bias=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
              (output): BertSelfOutput(
                (dense): Linear(in_features=768, out_features=768, bias=True)
                (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
            )
            (intermediate): BertIntermediate(
              (dense): Linear(in_features=768, out_features=3072, bias=True)
              (intermediate_act_fn): GELUActivation()
            )
            (output): BertOutput(
              (dense): Linear(in_features=3072, out_features=768, bias=True)
              (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
              (dropout): Dropout(p=0.1, inplace=False)
            )
          )
        )
      )
      (pooler): BertPooler(
        (dense): Linear(in_features=768, out_features=768, bias=True)
        (activation): Tanh()
      )
    )
  )
  (image_projection): LinearProjectionHead(
    (projection): Linear(in_features=2048, out_features=512, bias=True)
  )
  (text_projection): LinearProjectionHead(
    (projection): Linear(in_features=768, out_features=512, bias=True)
  )
)
[2024-07-15 10:48:21,948][breastclip.trainer][INFO] - cuda: Build the loss function
[2024-07-15 10:48:21,948][breastclip.trainer][INFO] - cuda: Build the optimizer
[2024-07-15 10:48:21,950][breastclip.trainer][INFO] - cuda: Build the LR scheulder
[2024-07-15 10:48:21,950][breastclip.trainer][INFO] - Download nltk module
[2024-07-15 10:48:22,128][breastclip.trainer][INFO] - zs_prompts: {'upmc': ['birads category 0', 'birads category 1', 'birads category 2'], 'rsna': ['no malignancy', 'malignancy']}
[2024-07-15 10:48:22,129][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7fe1e20ebf70>}
[2024-07-15 10:48:22,129][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7fe1e20ea2b0>}
[2024-07-15 10:48:22,138][breastclip.trainer][INFO] - cuda: Training the model
[2024-07-15 10:48:36,426][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/Devam/mammo-clip-github
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /home/devam/.cache/huggingface/hub/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-15 10:48:36,426][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-15 10:48:36,433][breastclip.trainer][INFO] - local_rank: -1
[2024-07-15 10:48:36,433][breastclip.trainer][INFO] - distributed: False
[2024-07-15 10:48:36,538][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-15 10:48:36,538][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-15 10:48:36,538][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-15 10:48:36,538][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-15 10:48:36,558][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7f74e9005af0>)
[2024-07-15 10:48:36,558][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-15 10:48:36,558][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-15 10:48:36,721][breastclip.data.datasets.imagetext][INFO] - split: train transform
[2024-07-15 10:48:36,721][breastclip.data.datasets.imagetext][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 10:48:36,728][breastclip.data.datasets.imagetext][INFO] - split: valid transform
[2024-07-15 10:48:36,728][breastclip.data.datasets.imagetext][INFO] - None
[2024-07-15 10:48:36,729][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 10:48:36,729][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 10:48:36,729][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 10:48:36,729][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 10:48:36,729][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 10:48:36,729][breastclip.data.datamodule][INFO] - Dataset: rsna_wo_period is loaded
[2024-07-15 10:48:36,886][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [train]
[2024-07-15 10:48:36,886][breastclip.data.datasets.image_classification][INFO] - split: train transform
[2024-07-15 10:48:36,886][breastclip.data.datasets.image_classification][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 10:48:36,887][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [valid]
[2024-07-15 10:48:36,887][breastclip.data.datasets.image_classification][INFO] - split: valid transform
[2024-07-15 10:48:36,887][breastclip.data.datasets.image_classification][INFO] - None
[2024-07-15 10:48:36,887][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 10:48:36,887][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 10:48:36,887][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 10:48:36,887][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 10:48:36,887][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 10:48:36,887][breastclip.data.datamodule][INFO] - Dataset: rsna_zs is loaded
[2024-07-15 10:48:36,887][breastclip.trainer][INFO] - cuda: Build the model
[2024-07-15 10:48:39,033][breastclip.trainer][INFO] - cuda: Model info:
BreastClip(
  (image_encoder): EfficientNet(
    (_conv_stem): Conv2dStaticSamePadding(
      3, 48, kernel_size=(3, 3), stride=(2, 2), bias=False
      (static_padding): ZeroPad2d((0, 1, 0, 1))
    )
    (_bn0): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_blocks): ModuleList(
      (0): MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          48, 48, kernel_size=(3, 3), stride=[1, 1], groups=48, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          48, 12, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          12, 48, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          48, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (1-2): 2 x MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(3, 3), stride=(1, 1), groups=24, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          24, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 24, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (3): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          24, 144, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          144, 144, kernel_size=(3, 3), stride=[2, 2], groups=144, bias=False
          (static_padding): ZeroPad2d((0, 1, 0, 1))
        )
        (_bn1): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          144, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 144, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          144, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (4-7): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(3, 3), stride=(1, 1), groups=240, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (8): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(5, 5), stride=[2, 2], groups=240, bias=False
          (static_padding): ZeroPad2d((1, 2, 1, 2))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (9-12): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(5, 5), stride=(1, 1), groups=384, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (13): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(3, 3), stride=[2, 2], groups=384, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (14-19): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(3, 3), stride=(1, 1), groups=768, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (20): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(5, 5), stride=[1, 1], groups=768, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (21-26): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=(1, 1), groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (27): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=[2, 2], groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (28-35): 8 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(5, 5), stride=(1, 1), groups=1824, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (36): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(3, 3), stride=[1, 1], groups=1824, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (37-38): 2 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          512, 3072, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          3072, 3072, kernel_size=(3, 3), stride=(1, 1), groups=3072, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          3072, 128, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          128, 3072, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          3072, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
    )
    (_conv_head): Conv2dStaticSamePadding(
      512, 2048, kernel_size=(1, 1), stride=(1, 1), bias=False
      (static_padding): Identity()
    )
    (_bn1): BatchNorm2d(2048, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_avg_pooling): AdaptiveAvgPool2d(output_size=1)
    (_dropout): Dropout(p=0.4, inplace=False)
    (_swish): MemoryEfficientSwish()
  )
  (text_encoder): HuggingfaceTextEncoder(
    (text_encoder): BertModel(
      (embeddings): BertEmbeddings(
        (word_embeddings): Embedding(28996, 768, padding_idx=0)
        (position_embeddings): Embedding(512, 768)
        (token_type_embeddings): Embedding(2, 768)
        (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
        (dropout): Dropout(p=0.1, inplace=False)
      )
      (encoder): BertEncoder(
        (layer): ModuleList(
          (0-11): 12 x BertLayer(
            (attention): BertAttention(
              (self): BertSdpaSelfAttention(
                (query): Linear(in_features=768, out_features=768, bias=True)
                (key): Linear(in_features=768, out_features=768, bias=True)
                (value): Linear(in_features=768, out_features=768, bias=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
              (output): BertSelfOutput(
                (dense): Linear(in_features=768, out_features=768, bias=True)
                (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
            )
            (intermediate): BertIntermediate(
              (dense): Linear(in_features=768, out_features=3072, bias=True)
              (intermediate_act_fn): GELUActivation()
            )
            (output): BertOutput(
              (dense): Linear(in_features=3072, out_features=768, bias=True)
              (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
              (dropout): Dropout(p=0.1, inplace=False)
            )
          )
        )
      )
      (pooler): BertPooler(
        (dense): Linear(in_features=768, out_features=768, bias=True)
        (activation): Tanh()
      )
    )
  )
  (image_projection): LinearProjectionHead(
    (projection): Linear(in_features=2048, out_features=512, bias=True)
  )
  (text_projection): LinearProjectionHead(
    (projection): Linear(in_features=768, out_features=512, bias=True)
  )
)
[2024-07-15 10:48:39,033][breastclip.trainer][INFO] - cuda: Build the loss function
[2024-07-15 10:48:39,033][breastclip.trainer][INFO] - cuda: Build the optimizer
[2024-07-15 10:48:39,035][breastclip.trainer][INFO] - cuda: Build the LR scheulder
[2024-07-15 10:48:39,035][breastclip.trainer][INFO] - Download nltk module
[2024-07-15 10:48:39,164][breastclip.trainer][INFO] - zs_prompts: {'upmc': ['birads category 0', 'birads category 1', 'birads category 2'], 'rsna': ['no malignancy', 'malignancy']}
[2024-07-15 10:48:39,164][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7f74e9007280>}
[2024-07-15 10:48:39,164][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7f74e8ff7340>}
[2024-07-15 10:48:39,173][breastclip.trainer][INFO] - cuda: Training the model
[2024-07-15 13:59:52,614][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/Devam/mammo-clip-github
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /home/devam/.cache/huggingface/hub/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-15 13:59:52,614][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-15 13:59:52,623][breastclip.trainer][INFO] - local_rank: -1
[2024-07-15 13:59:52,623][breastclip.trainer][INFO] - distributed: False
[2024-07-15 13:59:52,724][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-15 13:59:52,724][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-15 13:59:52,724][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-15 13:59:52,724][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-15 13:59:52,744][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7fbab1471c40>)
[2024-07-15 13:59:52,744][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-15 13:59:52,744][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-15 13:59:53,009][breastclip.data.datasets.imagetext][INFO] - split: train transform
[2024-07-15 13:59:53,009][breastclip.data.datasets.imagetext][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 13:59:53,015][breastclip.data.datasets.imagetext][INFO] - split: valid transform
[2024-07-15 13:59:53,015][breastclip.data.datasets.imagetext][INFO] - None
[2024-07-15 13:59:53,015][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 13:59:53,015][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 13:59:53,015][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 13:59:53,016][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 13:59:53,016][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 13:59:53,016][breastclip.data.datamodule][INFO] - Dataset: rsna_wo_period is loaded
[2024-07-15 13:59:53,169][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [train]
[2024-07-15 13:59:53,170][breastclip.data.datasets.image_classification][INFO] - split: train transform
[2024-07-15 13:59:53,170][breastclip.data.datasets.image_classification][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 13:59:53,170][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [valid]
[2024-07-15 13:59:53,170][breastclip.data.datasets.image_classification][INFO] - split: valid transform
[2024-07-15 13:59:53,170][breastclip.data.datasets.image_classification][INFO] - None
[2024-07-15 13:59:53,170][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 13:59:53,170][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 13:59:53,170][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 13:59:53,170][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 13:59:53,170][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 13:59:53,170][breastclip.data.datamodule][INFO] - Dataset: rsna_zs is loaded
[2024-07-15 13:59:53,170][breastclip.trainer][INFO] - cuda: Build the model
[2024-07-15 13:59:55,325][breastclip.trainer][INFO] - cuda: Model info:
BreastClip(
  (image_encoder): EfficientNet(
    (_conv_stem): Conv2dStaticSamePadding(
      3, 48, kernel_size=(3, 3), stride=(2, 2), bias=False
      (static_padding): ZeroPad2d((0, 1, 0, 1))
    )
    (_bn0): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_blocks): ModuleList(
      (0): MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          48, 48, kernel_size=(3, 3), stride=[1, 1], groups=48, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          48, 12, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          12, 48, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          48, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (1-2): 2 x MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(3, 3), stride=(1, 1), groups=24, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          24, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 24, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (3): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          24, 144, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          144, 144, kernel_size=(3, 3), stride=[2, 2], groups=144, bias=False
          (static_padding): ZeroPad2d((0, 1, 0, 1))
        )
        (_bn1): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          144, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 144, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          144, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (4-7): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(3, 3), stride=(1, 1), groups=240, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (8): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(5, 5), stride=[2, 2], groups=240, bias=False
          (static_padding): ZeroPad2d((1, 2, 1, 2))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (9-12): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(5, 5), stride=(1, 1), groups=384, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (13): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(3, 3), stride=[2, 2], groups=384, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (14-19): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(3, 3), stride=(1, 1), groups=768, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (20): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(5, 5), stride=[1, 1], groups=768, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (21-26): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=(1, 1), groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (27): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=[2, 2], groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (28-35): 8 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(5, 5), stride=(1, 1), groups=1824, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (36): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(3, 3), stride=[1, 1], groups=1824, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (37-38): 2 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          512, 3072, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          3072, 3072, kernel_size=(3, 3), stride=(1, 1), groups=3072, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          3072, 128, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          128, 3072, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          3072, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
    )
    (_conv_head): Conv2dStaticSamePadding(
      512, 2048, kernel_size=(1, 1), stride=(1, 1), bias=False
      (static_padding): Identity()
    )
    (_bn1): BatchNorm2d(2048, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_avg_pooling): AdaptiveAvgPool2d(output_size=1)
    (_dropout): Dropout(p=0.4, inplace=False)
    (_swish): MemoryEfficientSwish()
  )
  (text_encoder): HuggingfaceTextEncoder(
    (text_encoder): BertModel(
      (embeddings): BertEmbeddings(
        (word_embeddings): Embedding(28996, 768, padding_idx=0)
        (position_embeddings): Embedding(512, 768)
        (token_type_embeddings): Embedding(2, 768)
        (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
        (dropout): Dropout(p=0.1, inplace=False)
      )
      (encoder): BertEncoder(
        (layer): ModuleList(
          (0-11): 12 x BertLayer(
            (attention): BertAttention(
              (self): BertSdpaSelfAttention(
                (query): Linear(in_features=768, out_features=768, bias=True)
                (key): Linear(in_features=768, out_features=768, bias=True)
                (value): Linear(in_features=768, out_features=768, bias=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
              (output): BertSelfOutput(
                (dense): Linear(in_features=768, out_features=768, bias=True)
                (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
            )
            (intermediate): BertIntermediate(
              (dense): Linear(in_features=768, out_features=3072, bias=True)
              (intermediate_act_fn): GELUActivation()
            )
            (output): BertOutput(
              (dense): Linear(in_features=3072, out_features=768, bias=True)
              (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
              (dropout): Dropout(p=0.1, inplace=False)
            )
          )
        )
      )
      (pooler): BertPooler(
        (dense): Linear(in_features=768, out_features=768, bias=True)
        (activation): Tanh()
      )
    )
  )
  (image_projection): LinearProjectionHead(
    (projection): Linear(in_features=2048, out_features=512, bias=True)
  )
  (text_projection): LinearProjectionHead(
    (projection): Linear(in_features=768, out_features=512, bias=True)
  )
)
[2024-07-15 13:59:55,325][breastclip.trainer][INFO] - cuda: Build the loss function
[2024-07-15 13:59:55,325][breastclip.trainer][INFO] - cuda: Build the optimizer
[2024-07-15 13:59:55,327][breastclip.trainer][INFO] - cuda: Build the LR scheulder
[2024-07-15 13:59:55,327][breastclip.trainer][INFO] - Download nltk module
[2024-07-15 13:59:55,520][breastclip.trainer][INFO] - zs_prompts: {'upmc': ['birads category 0', 'birads category 1', 'birads category 2'], 'rsna': ['no malignancy', 'malignancy']}
[2024-07-15 13:59:55,521][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7fbab1474f70>}
[2024-07-15 13:59:55,521][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7fbab14732b0>}
[2024-07-15 13:59:55,531][breastclip.trainer][INFO] - cuda: Training the model
[2024-07-15 14:16:12,674][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/Devam/mammo-clip-github
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /home/devam/.cache/huggingface/hub/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-15 14:16:12,674][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-15 14:16:12,681][breastclip.trainer][INFO] - local_rank: -1
[2024-07-15 14:16:12,682][breastclip.trainer][INFO] - distributed: False
[2024-07-15 14:16:12,795][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-15 14:16:12,795][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-15 14:16:12,795][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-15 14:16:12,795][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-15 14:16:12,815][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7fc751a40a90>)
[2024-07-15 14:16:12,815][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-15 14:16:12,815][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-15 14:16:13,078][breastclip.data.datasets.imagetext][INFO] - split: train transform
[2024-07-15 14:16:13,078][breastclip.data.datasets.imagetext][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 14:16:13,085][breastclip.data.datasets.imagetext][INFO] - split: valid transform
[2024-07-15 14:16:13,085][breastclip.data.datasets.imagetext][INFO] - None
[2024-07-15 14:16:13,085][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 14:16:13,085][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 14:16:13,085][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 14:16:13,085][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 14:16:13,085][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 14:16:13,085][breastclip.data.datamodule][INFO] - Dataset: rsna_wo_period is loaded
[2024-07-15 14:16:13,242][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [train]
[2024-07-15 14:16:13,242][breastclip.data.datasets.image_classification][INFO] - split: train transform
[2024-07-15 14:16:13,242][breastclip.data.datasets.image_classification][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 14:16:13,243][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [valid]
[2024-07-15 14:16:13,243][breastclip.data.datasets.image_classification][INFO] - split: valid transform
[2024-07-15 14:16:13,243][breastclip.data.datasets.image_classification][INFO] - None
[2024-07-15 14:16:13,243][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 14:16:13,243][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 14:16:13,243][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 14:16:13,243][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 14:16:13,243][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 14:16:13,243][breastclip.data.datamodule][INFO] - Dataset: rsna_zs is loaded
[2024-07-15 14:16:13,243][breastclip.trainer][INFO] - cuda: Build the model
[2024-07-15 14:16:15,397][breastclip.trainer][INFO] - cuda: Model info:
BreastClip(
  (image_encoder): EfficientNet(
    (_conv_stem): Conv2dStaticSamePadding(
      3, 48, kernel_size=(3, 3), stride=(2, 2), bias=False
      (static_padding): ZeroPad2d((0, 1, 0, 1))
    )
    (_bn0): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_blocks): ModuleList(
      (0): MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          48, 48, kernel_size=(3, 3), stride=[1, 1], groups=48, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          48, 12, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          12, 48, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          48, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (1-2): 2 x MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(3, 3), stride=(1, 1), groups=24, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          24, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 24, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (3): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          24, 144, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          144, 144, kernel_size=(3, 3), stride=[2, 2], groups=144, bias=False
          (static_padding): ZeroPad2d((0, 1, 0, 1))
        )
        (_bn1): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          144, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 144, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          144, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (4-7): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(3, 3), stride=(1, 1), groups=240, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (8): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(5, 5), stride=[2, 2], groups=240, bias=False
          (static_padding): ZeroPad2d((1, 2, 1, 2))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (9-12): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(5, 5), stride=(1, 1), groups=384, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (13): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(3, 3), stride=[2, 2], groups=384, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (14-19): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(3, 3), stride=(1, 1), groups=768, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (20): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(5, 5), stride=[1, 1], groups=768, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (21-26): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=(1, 1), groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (27): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=[2, 2], groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (28-35): 8 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(5, 5), stride=(1, 1), groups=1824, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (36): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(3, 3), stride=[1, 1], groups=1824, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (37-38): 2 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          512, 3072, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          3072, 3072, kernel_size=(3, 3), stride=(1, 1), groups=3072, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          3072, 128, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          128, 3072, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          3072, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
    )
    (_conv_head): Conv2dStaticSamePadding(
      512, 2048, kernel_size=(1, 1), stride=(1, 1), bias=False
      (static_padding): Identity()
    )
    (_bn1): BatchNorm2d(2048, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_avg_pooling): AdaptiveAvgPool2d(output_size=1)
    (_dropout): Dropout(p=0.4, inplace=False)
    (_swish): MemoryEfficientSwish()
  )
  (text_encoder): HuggingfaceTextEncoder(
    (text_encoder): BertModel(
      (embeddings): BertEmbeddings(
        (word_embeddings): Embedding(28996, 768, padding_idx=0)
        (position_embeddings): Embedding(512, 768)
        (token_type_embeddings): Embedding(2, 768)
        (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
        (dropout): Dropout(p=0.1, inplace=False)
      )
      (encoder): BertEncoder(
        (layer): ModuleList(
          (0-11): 12 x BertLayer(
            (attention): BertAttention(
              (self): BertSdpaSelfAttention(
                (query): Linear(in_features=768, out_features=768, bias=True)
                (key): Linear(in_features=768, out_features=768, bias=True)
                (value): Linear(in_features=768, out_features=768, bias=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
              (output): BertSelfOutput(
                (dense): Linear(in_features=768, out_features=768, bias=True)
                (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
            )
            (intermediate): BertIntermediate(
              (dense): Linear(in_features=768, out_features=3072, bias=True)
              (intermediate_act_fn): GELUActivation()
            )
            (output): BertOutput(
              (dense): Linear(in_features=3072, out_features=768, bias=True)
              (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
              (dropout): Dropout(p=0.1, inplace=False)
            )
          )
        )
      )
      (pooler): BertPooler(
        (dense): Linear(in_features=768, out_features=768, bias=True)
        (activation): Tanh()
      )
    )
  )
  (image_projection): LinearProjectionHead(
    (projection): Linear(in_features=2048, out_features=512, bias=True)
  )
  (text_projection): LinearProjectionHead(
    (projection): Linear(in_features=768, out_features=512, bias=True)
  )
)
[2024-07-15 14:16:15,398][breastclip.trainer][INFO] - cuda: Build the loss function
[2024-07-15 14:16:15,398][breastclip.trainer][INFO] - cuda: Build the optimizer
[2024-07-15 14:16:15,399][breastclip.trainer][INFO] - cuda: Build the LR scheulder
[2024-07-15 14:16:15,400][breastclip.trainer][INFO] - Download nltk module
[2024-07-15 14:16:15,524][breastclip.trainer][INFO] - zs_prompts: {'upmc': ['birads category 0', 'birads category 1', 'birads category 2'], 'rsna': ['no malignancy', 'malignancy']}
[2024-07-15 14:16:15,525][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7fc751a42be0>}
[2024-07-15 14:16:15,525][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7fc751a31310>}
[2024-07-15 14:16:15,535][breastclip.trainer][INFO] - cuda: Training the model
[2024-07-15 16:28:02,019][__main__][INFO] - Configurations:
base:
  data_dir: /mnt/storage/Devam/mammo-clip-github
  period: 'n'
  resume_training: false
  epoch_to_start: 0
  checkpoint_to_start: ''
  train_fast: false
  fold: 0
  seed: 10
  amp: true
  mean: 0.3089279
  std: 0.25053555408335154
  image_size_h: 1520
  image_size_w: 912
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  zs_prompts:
    upmc:
    - birads category 0
    - birads category 1
    - birads category 2
    rsna:
    - no malignancy
    - malignancy
  output:
    args_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n
    checkpoint: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/
    tensorboard: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/
data_train:
  rsna_wo_period:
    name: rsna
    data_type: imagetext
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
data_zs:
  rsna_zs:
    name: rsna
    data_type: image_classification
    data_dir: /mnt/storage/Devam/mammo-clip-github
    img_dir: train_images_png
    data_path: Mammo-CLIP/src/codebase/data_csv/train_folds_final_1.csv
    text_max_length: 256
    data_frac: 1.0
    label_col: cancer
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 0
    batch_size: 4
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 0
    batch_size: 4
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 4
    batch_size: 6
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/huggingface/tokenizers
transform:
  train:
    Resize:
      size_h: 1520
      size_w: 912
    transform:
      affine_transform_degree: 20
      affine_translate_percent: 0.1
      affine_scale:
      - 0.8
      - 1.2
      affine_shear: 20
      elastic_transform_alpha: 10
      elastic_transform_sigma: 15
      p: 1.0
  valid:
    Resize:
      size_h: 1520
      size_w: 912
  test:
    Resize:
      size_h: 1520
      size_w: 912
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: cnn
    name: tf_efficientnet_b5_ns-detect
    pretrained: true
    model_type: cnn
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: /home/devam/.cache/huggingface/hub/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  breast_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0

[2024-07-15 16:28:02,019][breastclip.util.utils][INFO] - Global seed set to 10
[2024-07-15 16:28:02,026][breastclip.trainer][INFO] - local_rank: -1
[2024-07-15 16:28:02,026][breastclip.trainer][INFO] - distributed: False
[2024-07-15 16:28:02,143][breastclip.trainer][INFO] - cur_fold: 0
[2024-07-15 16:28:02,143][breastclip.trainer][INFO] - tensorboard_path_train: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/train
[2024-07-15 16:28:02,143][breastclip.trainer][INFO] - tensorboard_path_valid: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/tensorboard/fold_0/valid
[2024-07-15 16:28:02,143][breastclip.trainer][INFO] - check_pt_path: /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0
[2024-07-15 16:28:02,163][breastclip.trainer][INFO] - DistEnv: DistEnv(world_size=1, world_rank=0, local_rank=0, num_gpus=3, master=True, summary_writer=<breastclip.util.global_env.SummaryWriter object at 0x7fcde8404a00>)
[2024-07-15 16:28:02,163][breastclip.trainer][INFO] - cuda: Load datasets
[2024-07-15 16:28:02,163][breastclip.trainer][INFO] - =====================>>> Creating datasets <<<=====================
[2024-07-15 16:28:02,434][breastclip.data.datasets.imagetext][INFO] - split: train transform
[2024-07-15 16:28:02,434][breastclip.data.datasets.imagetext][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 16:28:02,441][breastclip.data.datasets.imagetext][INFO] - split: valid transform
[2024-07-15 16:28:02,441][breastclip.data.datasets.imagetext][INFO] - None
[2024-07-15 16:28:02,441][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 16:28:02,441][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 16:28:02,441][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 16:28:02,441][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 16:28:02,441][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 16:28:02,441][breastclip.data.datamodule][INFO] - Dataset: rsna_wo_period is loaded
[2024-07-15 16:28:02,598][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [train]
[2024-07-15 16:28:02,599][breastclip.data.datasets.image_classification][INFO] - split: train transform
[2024-07-15 16:28:02,599][breastclip.data.datasets.image_classification][INFO] - Compose([
  HorizontalFlip(always_apply=False, p=0.5),
  VerticalFlip(always_apply=False, p=0.5),
  Affine(always_apply=False, p=0.5, interpolation=1, mask_interpolation=0, cval=0.0, mode=0, scale={'x': (0.8, 1.2), 'y': (0.8, 1.2)}, translate_percent={'x': (0.1, 0.1), 'y': (0.1, 0.1)}, translate_px=None, rotate=(20.0, 20.0), fit_output=False, shear={'x': (20.0, 20.0), 'y': (20.0, 20.0)}, cval_mask=0.0, keep_ratio=False, rotate_method='largest_box'),
  ElasticTransform(always_apply=False, p=0.5, alpha=10.0, sigma=15.0, alpha_affine=50.0, interpolation=1, border_mode=4, value=None, mask_value=None, approximate=False, same_dxdy=False),
], p=1.0, bbox_params=None, keypoint_params=None, additional_targets={}, is_check_shapes=True)
[2024-07-15 16:28:02,599][breastclip.data.datasets.image_classification][INFO] - Loading Image classification dataset: [valid]
[2024-07-15 16:28:02,599][breastclip.data.datasets.image_classification][INFO] - split: valid transform
[2024-07-15 16:28:02,599][breastclip.data.datasets.image_classification][INFO] - None
[2024-07-15 16:28:02,599][breastclip.data.datamodule][INFO] - Loading fold: 0
[2024-07-15 16:28:02,599][breastclip.data.datamodule][INFO] - train_df length: (6977, 9)
[2024-07-15 16:28:02,599][breastclip.data.datamodule][INFO] - valid_df length: (2344, 9)
[2024-07-15 16:28:02,599][breastclip.data.datamodule][INFO] - Length of train_dataset: 6977
[2024-07-15 16:28:02,599][breastclip.data.datamodule][INFO] - Length of valid_dataset: 2344
[2024-07-15 16:28:02,599][breastclip.data.datamodule][INFO] - Dataset: rsna_zs is loaded
[2024-07-15 16:28:02,600][breastclip.trainer][INFO] - cuda: Build the model
[2024-07-15 16:28:05,174][breastclip.trainer][INFO] - cuda: Model info:
BreastClip(
  (image_encoder): EfficientNet(
    (_conv_stem): Conv2dStaticSamePadding(
      3, 48, kernel_size=(3, 3), stride=(2, 2), bias=False
      (static_padding): ZeroPad2d((0, 1, 0, 1))
    )
    (_bn0): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_blocks): ModuleList(
      (0): MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          48, 48, kernel_size=(3, 3), stride=[1, 1], groups=48, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(48, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          48, 12, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          12, 48, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          48, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (1-2): 2 x MBConvBlock(
        (_depthwise_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(3, 3), stride=(1, 1), groups=24, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          24, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 24, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          24, 24, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(24, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (3): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          24, 144, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          144, 144, kernel_size=(3, 3), stride=[2, 2], groups=144, bias=False
          (static_padding): ZeroPad2d((0, 1, 0, 1))
        )
        (_bn1): BatchNorm2d(144, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          144, 6, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          6, 144, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          144, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (4-7): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(3, 3), stride=(1, 1), groups=240, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 40, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(40, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (8): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          40, 240, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          240, 240, kernel_size=(5, 5), stride=[2, 2], groups=240, bias=False
          (static_padding): ZeroPad2d((1, 2, 1, 2))
        )
        (_bn1): BatchNorm2d(240, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          240, 10, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          10, 240, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          240, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (9-12): 4 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(5, 5), stride=(1, 1), groups=384, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 64, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(64, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (13): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          64, 384, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          384, 384, kernel_size=(3, 3), stride=[2, 2], groups=384, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(384, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          384, 16, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          16, 384, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          384, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (14-19): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(3, 3), stride=(1, 1), groups=768, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 128, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(128, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (20): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          128, 768, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          768, 768, kernel_size=(5, 5), stride=[1, 1], groups=768, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(768, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          768, 32, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          32, 768, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          768, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (21-26): 6 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=(1, 1), groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 176, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(176, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (27): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          176, 1056, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1056, 1056, kernel_size=(5, 5), stride=[2, 2], groups=1056, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1056, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1056, 44, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          44, 1056, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1056, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (28-35): 8 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(5, 5), stride=(1, 1), groups=1824, bias=False
          (static_padding): ZeroPad2d((2, 2, 2, 2))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 304, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(304, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (36): MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          304, 1824, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          1824, 1824, kernel_size=(3, 3), stride=[1, 1], groups=1824, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(1824, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          1824, 76, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          76, 1824, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          1824, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
      (37-38): 2 x MBConvBlock(
        (_expand_conv): Conv2dStaticSamePadding(
          512, 3072, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn0): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_depthwise_conv): Conv2dStaticSamePadding(
          3072, 3072, kernel_size=(3, 3), stride=(1, 1), groups=3072, bias=False
          (static_padding): ZeroPad2d((1, 1, 1, 1))
        )
        (_bn1): BatchNorm2d(3072, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_se_reduce): Conv2dStaticSamePadding(
          3072, 128, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_se_expand): Conv2dStaticSamePadding(
          128, 3072, kernel_size=(1, 1), stride=(1, 1)
          (static_padding): Identity()
        )
        (_project_conv): Conv2dStaticSamePadding(
          3072, 512, kernel_size=(1, 1), stride=(1, 1), bias=False
          (static_padding): Identity()
        )
        (_bn2): BatchNorm2d(512, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
        (_swish): MemoryEfficientSwish()
      )
    )
    (_conv_head): Conv2dStaticSamePadding(
      512, 2048, kernel_size=(1, 1), stride=(1, 1), bias=False
      (static_padding): Identity()
    )
    (_bn1): BatchNorm2d(2048, eps=0.001, momentum=0.010000000000000009, affine=True, track_running_stats=True)
    (_avg_pooling): AdaptiveAvgPool2d(output_size=1)
    (_dropout): Dropout(p=0.4, inplace=False)
    (_swish): MemoryEfficientSwish()
  )
  (text_encoder): HuggingfaceTextEncoder(
    (text_encoder): BertModel(
      (embeddings): BertEmbeddings(
        (word_embeddings): Embedding(28996, 768, padding_idx=0)
        (position_embeddings): Embedding(512, 768)
        (token_type_embeddings): Embedding(2, 768)
        (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
        (dropout): Dropout(p=0.1, inplace=False)
      )
      (encoder): BertEncoder(
        (layer): ModuleList(
          (0-11): 12 x BertLayer(
            (attention): BertAttention(
              (self): BertSdpaSelfAttention(
                (query): Linear(in_features=768, out_features=768, bias=True)
                (key): Linear(in_features=768, out_features=768, bias=True)
                (value): Linear(in_features=768, out_features=768, bias=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
              (output): BertSelfOutput(
                (dense): Linear(in_features=768, out_features=768, bias=True)
                (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
                (dropout): Dropout(p=0.1, inplace=False)
              )
            )
            (intermediate): BertIntermediate(
              (dense): Linear(in_features=768, out_features=3072, bias=True)
              (intermediate_act_fn): GELUActivation()
            )
            (output): BertOutput(
              (dense): Linear(in_features=3072, out_features=768, bias=True)
              (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
              (dropout): Dropout(p=0.1, inplace=False)
            )
          )
        )
      )
      (pooler): BertPooler(
        (dense): Linear(in_features=768, out_features=768, bias=True)
        (activation): Tanh()
      )
    )
  )
  (image_projection): LinearProjectionHead(
    (projection): Linear(in_features=2048, out_features=512, bias=True)
  )
  (text_projection): LinearProjectionHead(
    (projection): Linear(in_features=768, out_features=512, bias=True)
  )
)
[2024-07-15 16:28:05,174][breastclip.trainer][INFO] - cuda: Build the loss function
[2024-07-15 16:28:05,174][breastclip.trainer][INFO] - cuda: Build the optimizer
[2024-07-15 16:28:05,176][breastclip.trainer][INFO] - cuda: Build the LR scheulder
[2024-07-15 16:28:05,176][breastclip.trainer][INFO] - Download nltk module
[2024-07-15 16:28:05,364][breastclip.trainer][INFO] - zs_prompts: {'upmc': ['birads category 0', 'birads category 1', 'birads category 2'], 'rsna': ['no malignancy', 'malignancy']}
[2024-07-15 16:28:05,365][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7fcde8405c10>}
[2024-07-15 16:28:05,365][breastclip.trainer][INFO] - {'rsna': <torch.utils.data.dataloader.DataLoader object at 0x7fcde83f5550>}
[2024-07-15 16:28:05,375][breastclip.trainer][INFO] - cuda: Training the model
[2024-07-15 17:42:05,148][breastclip.trainer][INFO] - Epoch 1, last-model saved
[2024-07-15 17:53:42,914][breastclip.trainer][INFO] - /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0/model-best.tar saved
[2024-07-15 19:07:53,894][breastclip.trainer][INFO] - Epoch 2, last-model saved
[2024-07-15 19:19:50,008][breastclip.trainer][INFO] - /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0/model-best.tar saved
[2024-07-15 20:35:09,328][breastclip.trainer][INFO] - Epoch 3, last-model saved
[2024-07-15 20:47:21,382][breastclip.trainer][INFO] - /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0/model-best.tar saved
[2024-07-15 22:02:27,517][breastclip.trainer][INFO] - Epoch 4, last-model saved
[2024-07-15 23:14:38,682][breastclip.trainer][INFO] - Epoch 5, last-model saved
[2024-07-16 00:27:27,818][breastclip.trainer][INFO] - Epoch 6, last-model saved
[2024-07-16 00:37:32,520][breastclip.trainer][INFO] - /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0/model-best.tar saved
[2024-07-16 01:49:45,042][breastclip.trainer][INFO] - Epoch 7, last-model saved
[2024-07-16 01:59:16,751][breastclip.trainer][INFO] - /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0/model-best.tar saved
[2024-07-16 03:11:17,617][breastclip.trainer][INFO] - Epoch 8, last-model saved
[2024-07-16 04:24:17,355][breastclip.trainer][INFO] - Epoch 9, last-model saved
[2024-07-16 04:35:32,378][breastclip.trainer][INFO] - /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0/model-best.tar saved
[2024-07-16 05:48:32,774][breastclip.trainer][INFO] - Epoch 10, last-model saved
[2024-07-16 07:01:22,987][breastclip.trainer][INFO] - Epoch 11, last-model saved
[2024-07-16 08:13:12,976][breastclip.trainer][INFO] - Epoch 12, last-model saved
[2024-07-16 09:24:30,790][breastclip.trainer][INFO] - Epoch 13, last-model saved
[2024-07-16 09:33:46,777][breastclip.trainer][INFO] - /mnt/storage/Devam/mammo-clip-github/Mammo-CLIP/src/codebase/outputs/upmc_clip/b5_detector_period_n/checkpoints/fold_0/model-best.tar saved
[2024-07-16 10:45:16,102][breastclip.trainer][INFO] - Epoch 14, last-model saved
[2024-07-16 11:56:38,398][breastclip.trainer][INFO] - Epoch 15, last-model saved
[2024-07-16 11:56:38,405][breastclip.trainer][INFO] - cuda: Training has been completed
